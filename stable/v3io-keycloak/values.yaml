keycloak:
  fullnameOverride: v3io-keycloak
  image:
    repository: gcr.io/iguazio/keycloak
    tag: 20.0.5-debian-11-r6
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP

  postgresql:
    enabled: false

  externalDatabase:
    host: v3io-keycloak-db
    port: 3306
    user: keycloak-admin
    database: keycloak

    # if you change this value, be sure to change the value in v3io-mysql.adminSecret.name as well
    existingSecret: v3io-keycloak-db-creds

  extraEnvVars:
    - name: KEYCLOAK_DATABASE_VENDOR
      value: mysql

  initContainerImage: alpine:3.17
  initContainers: |
    - name: wait-for-mysql
      image: {{ .Values.initContainerImage }}
      imagePullPolicy: IfNotPresent
      command: ['sh', '-c']
      args:
        - echo -e "Waiting MySQL Server deployment availability";
          while ! nc -z {{ .Values.externalDatabase.host }} {{ .Values.externalDatabase.port | quote }}; do
            sleep 1;
            echo "MySQL Server not available yet";
          done;
          echo -e "MySQL Server has started";

v3io-mysql:
  fullnameOverride: v3io-keycloak-db
  createDatabase: keycloak

  adminSecret:
    create: false
    name: v3io-keycloak-db-creds

  persistence:
    v3io:
      mountPath: /keycloak/mysql

  service:
    port: 3306
