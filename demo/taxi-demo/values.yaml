v3io:
  webApi: localhost:8081
  auth:
    username: iguazio
    password: iguazio
  projects:
    create: true
    items:
    - name: taxi-demo
      displayName: Taxi Demo 
  functions:
    create: true
    items:
    - name: generate-data
      url: generate-data:8080
      handler: "functions.generate_data.generate_data:handler"
      runtime: "python:3.6"
      projectName: "taxi-demo"
      commands:
        - pip install requests==2.19.1
      functionSourceCode: "aW1wb3J0IHJlcXVlc3RzDQppbXBvcnQgb3MNCmltcG9ydCBqc29uDQppbXBvcnQgcmFuZG9tDQpmcm9tIGRlY2ltYWwgaW1wb3J0ICoNCg0KIyBMaXN0IG9mIEdQUyBjb29yZGluYXRlcyBmb3IgcmFuZG9tbHkgc2VsZWN0ZWQgbG9jYXRpb25zDQphbGxfbG9jYXRpb25zID0gew0KICAgICdkb3dudG93bl9sb25kb24nOiB7J2xvbmcnOiAtMC4xMTk1LCAnbGF0JzogNTEuNTAzM30sDQogICAgJ3dlc3RtaW5zdGVyJzogeydsb25nJzogLTAuMTM1NywgJ2xhdCc6IDUxLjQ5NzV9LA0KICAgICdveGZvcmRfc3QnOiB7J2xvbmcnOiAtMC4xNDEwLCAnbGF0JzogNTEuNTE1NH0sDQogICAgJ2hlYXRocm93Jzogeydsb25nJzogLTAuNDU0MywgJ2xhdCc6IDUxLjQ3MDB9LA0KICAgICdoZWF0aHJvd19wYXJraW5nJzogeydsb25nJzogLTAuNDQ3MywgJ2xhdCc6IDUxLjQ1OTl9LA0KICAgICdnYXR3aWNrJzogeydsb25nJzogMC4xODIxLCAnbGF0JzogNTEuMTUzN30sDQogICAgJ2NhbmFyeV93aGFyZic6IHsnbG9uZyc6IC0wLjAyMzUsICdsYXQnOiA1MS41MDU0fQ0KfQ0KDQojIE1vc3QgZHJpdmVycyBhcmUgaW4gZG93bnRvd24gLSBwcm92aWRlIG1vcmUgd2VpZ2h0IHRvIGRvd250b3duIC0gbm90ZSB0aGlzIGlzIGp1c3QgYW4gZXhhbXBsZQ0KZHJpdmVyc193ZWlnaHRlZF9sb2NhdGlvbnMgPSB7J2Rvd250b3duX2xvbmRvbic6IDQsICd3ZXN0bWluc3Rlcic6IDN9DQoNCiMgTW9zdCBwYXNzZW5nZXJzIGFyZSBpbiBhaXJwb3J0cyAtIHByb3ZpZGUgbW9yZSB3ZWlnaHQgdG8gZG93bnRvd24gLSBub3RlIHRoaXMgaXMganVzdCBhbiBleGFtcGxlDQpwYXNzZW5nZXJzX3dlaWdodGVkX2xvY2F0aW9ucyA9IHsnaGVhdGhyb3cnOiA0LCAnaGVhdGhyb3dfcGFya2luZyc6IDMsICdnYXR3aWNrJzogNH0NCg0KIyBHZXQgSVAgYW5kIFBvcnQgb2YgdGhlIGluZ2VzdGlvbiBmdW5jdGlvbiBmcm9tIE51Y2xpbyBlbnZpcm9ubWVudCB2YXJpYWJsZXMNCmluZ2VzdF91cmwgPSBvcy5lbnZpcm9uWyJJTkdFU1RfVVJMIl0NCg0KIyBOdW1iZXIgb2YgZHJpdmVycyBhbmQgcGFzc2VuZ2VycyB0byBpbmdlc3QNCm51bV9kcml2ZXJzX3RvX2luZ2VzdCA9IDEwMDANCm51bV9wYXNzZW5nZXJzX3RvX2luZ2VzdCA9IDUwMA0KDQojIE1heCBJRCBmb3IgZHJpdmVycyBhbmQgcGFzc2VuZ2VycywgZGVmaW5lcyB0aGUgdG90YWwgbnVtYmVyIGluIHRoZSBzeXN0ZW0NCm1heF9kcml2ZXJfaWQgPSA1MDAwDQptYXhfcGFzc2VuZ2VyX2lkID0gNTAwMA0KDQoNCmRlZiBoYW5kbGVyKGNvbnRleHQsIGV2ZW50KToNCg0KICAgICMgaW5nZXN0IGRyaXZlcnMNCiAgICBfaW5nZXN0X2xvY2F0aW9ucyhjb250ZXh0LCBpbmdlc3RfdXJsLCBudW1fZHJpdmVyc190b19pbmdlc3QsIG1heF9kcml2ZXJfaWQsICdkcml2ZXInLCBkcml2ZXJzX3dlaWdodGVkX2xvY2F0aW9ucykNCg0KICAgICMgaW5nZXN0IHBhc3NlbmdlcnMNCiAgICBfaW5nZXN0X2xvY2F0aW9ucyhjb250ZXh0LCBpbmdlc3RfdXJsLCBudW1fcGFzc2VuZ2Vyc190b19pbmdlc3QsIG1heF9wYXNzZW5nZXJfaWQsICdwYXNzZW5nZXInLCBwYXNzZW5nZXJzX3dlaWdodGVkX2xvY2F0aW9ucykNCg0KICAgIHJldHVybiBjb250ZXh0LlJlc3BvbnNlKHN0YXR1c19jb2RlPTIwNCkNCg0KDQpkZWYgX2luZ2VzdF9sb2NhdGlvbnMoY29udGV4dCwgaW5nZXN0X3VybCwgbnVtX3JlY29yZHMsIG1heF9yZWNvcmRfaWQsIHJlY29yZF90eXBlLCB3ZWlnaHRlZF9sb2NhdGlvbnMpOg0KDQogICAgIyBnZW5lcmF0ZSByYW5kb20gbG9jYXRpb24gZm9yIDEwMDAgZHJpdmVycyBhbmQgc2VuZCBmb3IgaW5nZXN0aW9uDQogICAgZm9yIF8gaW4gcmFuZ2UoMSwgbnVtX3JlY29yZHMpOg0KDQogICAgICAgICMgZ2V0IGEgcmFuZG9tIGxvY2F0aW9ucw0KICAgICAgICByYW5kb21fbG9jYXRpb24gPSBfZ2V0X3JhbmRvbV9sb2NhdGlvbihfd2VpZ2h0ZWRfa2V5cyhhbGxfbG9jYXRpb25zLCB3ZWlnaHRlZF9sb2NhdGlvbnMpKQ0KDQogICAgICAgIHJlcXVlc3QgPSB7DQogICAgICAgICAgICAgICAgICAnUmVjb3JkVHlwZSc6IHJlY29yZF90eXBlLA0KICAgICAgICAgICAgICAgICAgJ0lEJzogcmFuZG9tLnJhbmRpbnQoMSwgbWF4X3JlY29yZF9pZCksDQogICAgICAgICAgICAgICAgICAnTG9uZ2l0dWRlJzogX2dldF9yYW5kb21fb2Zmc2V0KGFsbF9sb2NhdGlvbnNbcmFuZG9tX2xvY2F0aW9uXVsnbG9uZyddKSwNCiAgICAgICAgICAgICAgICAgICdMYXRpdHVkZSc6IF9nZXRfcmFuZG9tX29mZnNldChhbGxfbG9jYXRpb25zW3JhbmRvbV9sb2NhdGlvbl1bJ2xhdCddKQ0KICAgICAgICB9DQoNCiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wdXQoaW5nZXN0X3VybCwgZGF0YT1qc29uLmR1bXBzKHJlcXVlc3QpKQ0KDQogICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlICE9IHJlcXVlc3RzLmNvZGVzLm9rOg0KICAgICAgICAgICAgbWVzc2FnZSA9IGYnSW5nZXN0aW9uIG9mIGRyaXZlcnMgZmFpbGVkIHdpdGggZXJyb3IgY29kZSB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9Jw0KICAgICAgICAgICAgY29udGV4dC5sb2dnZXIuZXJyb3IobWVzc2FnZSkNCiAgICAgICAgICAgIHJldHVybiBjb250ZXh0LlJlc3BvbnNlKGJvZHk9eydlcnJvcic6IG1lc3NhZ2V9LCBzdGF0dXNfY29kZT01MDApDQoNCg0KIyBnZXQgYSByYW5kb20gbG9jYXRpb24gZnJvbSB0aGUgYXZhaWxhYmxlIGxvY2F0aW9ucw0KZGVmIF9nZXRfcmFuZG9tX2xvY2F0aW9uKGxvY2F0aW9ucyk6DQogICAgcmV0dXJuIHJhbmRvbS5jaG9pY2UobG9jYXRpb25zKQ0KDQoNCiMgbW92ZSB0byBhIGNsb3NlIG9mZnNldCBvZiB0aGUgZXhhY3QgcG9pbnQgLSBmb3IgZGVtbyBwdXJwb3NlcyBvbmx5DQpkZWYgX2dldF9yYW5kb21fb2Zmc2V0KGxvY2F0aW9uKToNCiAgICBybmRfcmFkaXVzID0gcmFuZG9tLnJhbmRpbnQoMCwgOCkNCiAgICBybmRfb2Zmc2V0ID0gcmFuZG9tLnJhbmRpbnQoLXJuZF9yYWRpdXMsIHJuZF9yYWRpdXMpDQoNCiAgICBuZXdfbG9jYXRpb24gPSBEZWNpbWFsKGxvY2F0aW9uKSArIChEZWNpbWFsKHJuZF9vZmZzZXQpIC8gRGVjaW1hbCgzMDApKQ0KDQogICAgcmV0dXJuIHN0cihuZXdfbG9jYXRpb24pDQoNCg0KIyBnaXZlbiBkaWN0ICJkIiwgcmV0dXJucyB0aGUga2V5cyB3ZWlnaHRlZCBieSB3ZWlnaHQgIndlaWdodHMiDQojIEZvciBleGFtcGxlOg0KIyAgaW5wdXQ6IGQgPSB7J2EnOiAxLCAnYic6IDIsICdjJzogM30sIHdlaWdodHMgPSB7J2InOiAzLCAnYyc6IDJ9DQojICBvdXRwdXQ6IFsnYScsICdiJywgJ2InLCAnYicsICdjJywgJ2MnXQ0KZGVmIF93ZWlnaHRlZF9rZXlzKGQsIHdlaWdodHMpOg0KICAgIHJlc3VsdCA9IFtdDQoNCiAgICBmb3Iga2V5IGluIGQua2V5cygpOg0KICAgICAgICByZXN1bHQuZXh0ZW5kKFtrZXldICogd2VpZ2h0cy5nZXQoa2V5LCAxKSkNCg0KICAgIHJldHVybiByZXN1bHQNCg==" 
      env:
        - name: INGEST_URL
          value: "http://ingest:8080"
      image:
        repository: iguaziodocker/cloud_demo_functions
        tag: "0.0.2"
    - name: ingest
      url: ingest:8080
      handler: "functions.ingest.ingest:handler"
      runtime: "python:3.6"
      projectName: "taxi-demo"
      commands:
        - pip install requests==2.19.1
        - pip install s2sphere==0.2.5
      functionSourceCode: "aW1wb3J0IHJlcXVlc3RzCmltcG9ydCBqc29uCmltcG9ydCBvcwppbXBvcnQgczJzcGhlcmUKCiMgR2V0IGNvbmZpZ3VyYXRpb24gaW5mb3JtYXRpb24gZnJvbSBlbnZpcm9ubWVudCB2YXJpYWJsZXMgZGVmaW5lZCB1c2luZyBOdWNsaW8KIyBXZWItQVBJcyAod2ViLWdhdGV3YXkpIFVSTApXRUJBUElfVVJMICAgICA9IHN0cihvcy5nZXRlbnYoJ1dFQkFQSV9VUkwnKSkKIyBDb250YWluZXIgbmFtZQpDT05UQUlORVJfTkFNRSA9IHN0cihvcy5nZXRlbnYoJ0NPTlRBSU5FUl9OQU1FJykpCiMgV2ViLUFQSXMgdXNlciBjcmVkZW50aWFscyAodXNlZCBmb3IgSFRUUCBhdXRoZW50aWNhdGlvbikKV0VCQVBJX1VTRVIgPSBvcy5nZXRlbnYoJ1dFQkFQSV9VU0VSJykKV0VCQVBJX1BBU1NXT1JEID0gb3MuZ2V0ZW52KCdXRUJBUElfUEFTU1dPUkQnKQpXRUJBUElfQ1JFRCA9IG9zLmdldGVudignV0VCQVBJX0NSRUQnKQojIFRhYmxlIHBhdGhzCkRSSVZFUlNfVEFCTEVfUEFUSCA9IENPTlRBSU5FUl9OQU1FICsgc3RyKG9zLmdldGVudignRFJJVkVSU19UQUJMRScpKQpQQVNTRU5HRVJTX1RBQkxFX1BBVEggPSBDT05UQUlORVJfTkFNRSArIHN0cihvcy5nZXRlbnYoJ1BBU1NFTkdFUlNfVEFCTEUnKSkKQ0VMTFNfVEFCTEVfUEFUSCAgID0gQ09OVEFJTkVSX05BTUUgKyBzdHIob3MuZ2V0ZW52KCdDRUxMU19UQUJMRScpKQoKRFJJVkVSX1BSRUZJWCA9ICdkcml2ZXJzXycKUEFTU0VOR0VSX1BSRUZJWCA9ICdwYXNzZW5nZXJzXycKClYzSU9fSEVBREVSX0ZVTkNUSU9OID0gJ1gtdjNpby1mdW5jdGlvbicKCmRlZiBoYW5kbGVyKGNvbnRleHQsIGV2ZW50KToKCiAgICAjIFJlYWQgdGhlIGRhdGEgdG8gYmUgaW5nZXN0ZWQgZnJvbSB0aGUgaW5wdXQgSlNPTiByZXF1ZXN0IGJvZHkKICAgIGlucHV0X2RhdGFfanNvbiA9IGV2ZW50LmJvZHkgCiAgICBpbnB1dF9kYXRhID0ganNvbi5sb2FkcyhpbnB1dF9kYXRhX2pzb24pCgogICAgcmVjb3JkX3R5cGUgPSBzdHIoaW5wdXRfZGF0YSBbIlJlY29yZFR5cGUiXSkKCiAgICBpZCA9IHN0cihpbnB1dF9kYXRhIFsiSUQiXSkKICAgIAogICAgbG9uZ2l0dWRlID0gZmxvYXQgKGlucHV0X2RhdGFbIkxvbmdpdHVkZSJdKQogICAgbGF0aXR1ZGUgPSBmbG9hdCAoaW5wdXRfZGF0YVsiTGF0aXR1ZGUiXSkKCiAgICAjIFVzZSB0aGUgR29vZ2xlIHMyc3BoZXJlIGxpYnJhcnkgdG8gY2FsY3VsYXRlIGEgY2VsbCBmcm9tIHRoZSBsb25naXR1ZGUKICAgICMgYW5kIGxhdGl0dWRlIGRlZ3JlZXMKICAgIHAxID0gczJzcGhlcmUuTGF0TG5nLmZyb21fZGVncmVlcyhsYXRpdHVkZSxsb25naXR1ZGUpCiAgICBjZWxsID0gczJzcGhlcmUuQ2VsbElkLmZyb21fbGF0X2xuZyhwMSkucGFyZW50KDE1KQogICAgY2VsbF9pZCA9IHN0cihjZWxsLmlkKCkpCiAgICAKICAgICMgQ3JlYXRlIGEgc2Vzc2lvbiBmb3Igc2VuZGluZyBOb1NRTCBXZWIgQVBJIHJlcXVlc3RzCiAgICBzID0gcmVxdWVzdHMuU2Vzc2lvbigpCgogICAgIyBQcm92aWRlIHdlYmFwaSB1c2VyL3Bhc3MKICAgIGlmIFdFQkFQSV9VU0VSIGlzIG5vdCBOb25lOgogICAgICAgIHMuYXV0aCA9IChzdHIoV0VCQVBJX1VTRVIpLCBzdHIoV0VCQVBJX1BBU1NXT1JEKSkKICAgIAogICAgIyBJbmdlc3Rpb24gb2YgYm90aCBkcml2ZXJzIGFuZCBwYXNzZW5nZXJzIGFyZSBzdXBwb3J0ZWQKICAgICMgRGVwZW5kaW5nIG9uIHJlY29yZCB0eXBlLCByZWxldmFudCB0YWJsZXMgd2lsbCBiZSB1cGRhdGVkCiAgICBpZiByZWNvcmRfdHlwZSA9PSAnZHJpdmVyJzoKICAgICAgICBJVEVNX1BSRUZJWCA9IERSSVZFUl9QUkVGSVgKICAgICAgICBJVEVNX1BBVEggICA9IERSSVZFUlNfVEFCTEVfUEFUSAogICAgZWxzZSA6CiAgICAgICAgSVRFTV9QUkVGSVggPSBQQVNTRU5HRVJfUFJFRklYCiAgICAgICAgSVRFTV9QQVRIID0gUEFTU0VOR0VSU19UQUJMRV9QQVRICgogICAgIyBVcGRhdGUgdGhlIGRyaXZlcidzIGN1cnJlbnQgYW5kIHByZXZpb3VzIGxvY2F0aW9uIAogICAgcmVzID0gbmd4X3VwZGF0ZV9leHByZXNzaW9uX3JlcXVlc3QocyxXRUJBUElfVVJMLCBJVEVNX1BBVEggKyBJVEVNX1BSRUZJWCAraWQsIE5vbmUsIE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiU0VUIHByZXZpb3VzX2NlbGxfaWQ9aWZfbm90X2V4aXN0cyhjdXJyZW50X2NlbGxfaWQsMCk7Y3VycmVudF9jZWxsX2lkPSIgKyBjZWxsX2lkICsgIjtjaGFuZ2VfY2VsbF9pZF9pbmRpY2F0b3I9KHByZXZpb3VzX2NlbGxfaWQgIT0gY3VycmVudF9jZWxsX2lkKTsiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5vbmUpCgogICAgaWYgcmVzLnN0YXR1c19jb2RlIG5vdCBpbiAoMjAwLDIwNCk6CiAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmVycm9yICgiRXJyb3IgZHVyaW5nIHVwZGF0ZSBvZiBkcml2ZXJzIHRhYmxlLiBFcnJvciBjb2RlIGlzICIrc3RyKHJlcy5zdGF0dXNfY29kZSkpCiAgICAgICAgICAgIHJldHVybiBjb250ZXh0LlJlc3BvbnNlKGJvZHk9J0ludGVybmFsIGVycm9yIGR1cmluZyBpbmdlc3Rpb24nLGNvbnRlbnRfdHlwZT0ndGV4dC9wbGFpbicsc3RhdHVzX2NvZGU9NTAwKQogICAgCiAgICAjIEdldCB0aGUgZHJpdmVyJ3MgY3VycmVudCBhbmQgcHJldmlvdXMgY2VsbAogICAgcmVzcG9uc2VfanNvbiA9IG5neF9nZXRfaXRlbV9yZXF1ZXN0KHMsV0VCQVBJX1VSTCwgSVRFTV9QQVRIICsgSVRFTV9QUkVGSVggK2lkLE5vbmUsTm9uZSxleHBfYXR0cnM9WyJjaGFuZ2VfY2VsbF9pZF9pbmRpY2F0b3IiLCJjdXJyZW50X2NlbGxfaWQiLCJwcmV2aW91c19jZWxsX2lkIl0pCgogICAgIyBDaGVjayB3aGV0aGVyIGEgY2VsbC11cGRhdGUgaXMgbmVlZGVkCiAgICBhdHRycyA9IHJlc3BvbnNlX2pzb25bIkl0ZW0iXQogICAgY2hhbmdlX2NlbGxfaWRfaW5kaWNhdG9yX3ZhbCA9IGF0dHJzWyJjaGFuZ2VfY2VsbF9pZF9pbmRpY2F0b3IiXVsiQk9PTCJdCiAgICBjdXJyZW50X2NlbGxfaWRfdmFsID0gYXR0cnNbImN1cnJlbnRfY2VsbF9pZCJdWyJOIl0KICAgIHByZXZpb3VzX2NlbGxfaWRfdmFsID0gYXR0cnNbInByZXZpb3VzX2NlbGxfaWQiXVsiTiJdCgogICAgIyBJZiB0aGUgZHJpdmVyJ3MgY2VsbCBoYXMgY2hhbmdlZCwgaW5jcmVhc2UgdGhlIGRyaXZlcnMgY291bnQgZm9yIHRoZSBuZXcKICAgICMgY2VsbCBhbmQgZGVjcmVhc2UgdGhlIGNvdW50IGZvciB0aGUgb2xkIGNlbGwKICAgIGlmIGNoYW5nZV9jZWxsX2lkX2luZGljYXRvcl92YWw6CiAgICAgICAgICAgICMgSW5jcmVhc2UgdGhlIGNvdW50IGZvciB0aGUgZHJpdmVyJ3MgbmV3IChjdXJyZW50KSBjZWxsCiAgICAgICAgICAgIHJlcz1uZ3hfdXBkYXRlX2V4cHJlc3Npb25fcmVxdWVzdChzLFdFQkFQSV9VUkwsIENFTExTX1RBQkxFX1BBVEggKyAiY2VsbF8iKyBjdXJyZW50X2NlbGxfaWRfdmFsLCBOb25lLCBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiU0VUICIrSVRFTV9QUkVGSVgrImNvdW50PWlmX25vdF9leGlzdHMoIitJVEVNX1BSRUZJWCsiY291bnQsMCkrMTsiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOb25lKQoKICAgICAgICAgICAgaWYgcmVzLnN0YXR1c19jb2RlIG5vdCBpbiAoMjAwLDIwNCk6CiAgICAgICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5lcnJvciAoIkVycm9yIGR1cmluZyBpbmNyZW1lbnQgb2YgY291bnQgaW4gY2VsbHMgdGFibGUuIEVycm9yIGNvZGUgaXMgIitzdHIocmVzLnN0YXR1c19jb2RlKSkKICAgICAgICAgICAgICAgIHJldHVybiBjb250ZXh0LlJlc3BvbnNlKGJvZHk9J0ludGVybmFsIGVycm9yIGR1cmluZyBpbmdlc3Rpb24nLGNvbnRlbnRfdHlwZT0ndGV4dC9wbGFpbicsc3RhdHVzX2NvZGU9NTAwKQoKCiAgICAgICAgICAgICMgRGVjcmVhc2UgdGhlIGNvdW50IGZvciB0aGUgZHJpdmVyJ3MgcHJldmlvdXMgY2VsbAogICAgICAgICAgICByZXMgPSBuZ3hfdXBkYXRlX2V4cHJlc3Npb25fcmVxdWVzdChzLFdFQkFQSV9VUkwsIENFTExTX1RBQkxFX1BBVEggKyAiY2VsbF8iICsgcHJldmlvdXNfY2VsbF9pZF92YWwsIE5vbmUsIE5vbmUsTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlNFVCAiK0lURU1fUFJFRklYKyJjb3VudD0iK0lURU1fUFJFRklYKyJjb3VudC0xOyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5vbmUpCgogICAgICAgICAgICAjIGlmIHJlcy5zdGF0dXNfY29kZSBub3QgaW4gKDIwMCwyMDQpOgogICAgICAgICAgICAjICAgICBjb250ZXh0LmxvZ2dlci5lcnJvciAoIkVycm9yIGR1cmluZyBkZWNyZW1lbnQgb2YgY291bnQgaW4gY2VsbHMgdGFibGUuIEVycm9yIGNvZGUgaXMgIitzdHIocmVzLnN0YXR1c19jb2RlKSkKICAgICAgICAgICAgIyAgICAgcmV0dXJuIGNvbnRleHQuUmVzcG9uc2UoYm9keT0nSW50ZXJuYWwgZXJyb3IgZHVyaW5nIGluZ2VzdGlvbicsY29udGVudF90eXBlPSd0ZXh0L3BsYWluJyxzdGF0dXNfY29kZT01MDApCgogICAgcmV0dXJuIGNvbnRleHQuUmVzcG9uc2UoYm9keT0nSW5nZXN0aW9uIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycz17fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRfdHlwZT0ndGV4dC9wbGFpbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNfY29kZT0yMDApCgojCiMgQ29uc3RydWN0IGFuZCBzZW5kIGEgR2V0SXRlbSBOb1NRTCBXZWIgQVBJIHJlcXVlc3QKIwpkZWYgbmd4X2dldF9pdGVtX3JlcXVlc3QoCiAgICAgICAgcyxiYXNlX3VybCwgcGF0aF9pbl91cmwsIHRhYmxlX25hbWU9Tm9uZSwga2V5PU5vbmUsIGV4cF9hdHRycz1Ob25lLCBleHBlY3RlZF9yZXN1bHQ9cmVxdWVzdHMuY29kZXMub2spOgogICAgdXJsID0gb3MucGF0aC5qb2luKGJhc2VfdXJsLCBwYXRoX2luX3VybCkKCiAgICAjIEJ1aWxkIGEgSlNPTiByZXF1ZXN0IGJvZHkKICAgIHJlcXVlc3RfanNvbiA9IHt9CgogICAgaWYgdGFibGVfbmFtZSBpcyBub3QgTm9uZToKICAgICAgICByZXF1ZXN0X2pzb25bIlRhYmxlTmFtZSJdID0gdGFibGVfbmFtZQoKICAgIHJlcXVlc3RfanNvblsiQXR0cmlidXRlc1RvR2V0Il0gPSAiIgoKICAgIGZvciBhdHRyX25hbWUgaW4gZXhwX2F0dHJzOgogICAgICAgIGlmIHJlcXVlc3RfanNvblsiQXR0cmlidXRlc1RvR2V0Il0gIT0gIiI6CiAgICAgICAgICAgIHJlcXVlc3RfanNvblsiQXR0cmlidXRlc1RvR2V0Il0gKz0gIiwiCiAgICAgICAgcmVxdWVzdF9qc29uWyJBdHRyaWJ1dGVzVG9HZXQiXSArPSBhdHRyX25hbWUKCiAgICBwYXlsb2FkID0ganNvbi5kdW1wcyhyZXF1ZXN0X2pzb24pCiAgICAKICAgIGlmIFdFQkFQSV9DUkVEIGlzIE5vbmU6CiAgICAgICAgaGVhZGVycyA9IHtWM0lPX0hFQURFUl9GVU5DVElPTjogJ0dldEl0ZW0nfQogICAgZWxzZToKICAgICAgICBoZWFkZXJzID0ge1YzSU9fSEVBREVSX0ZVTkNUSU9OOiAnR2V0SXRlbScsIkF1dGhvcml6YXRpb24iOiBzdHIoV0VCQVBJX0NSRUQpfQogICAgCiAgICAjIFNlbmQgdGhlIHJlcXVlc3QKICAgIHJlcyA9IHMucHV0KHVybCwgZGF0YT1wYXlsb2FkLCBoZWFkZXJzPWhlYWRlcnMpCgogICAgYXNzZXJ0IHJlcy5zdGF0dXNfY29kZSA9PSBleHBlY3RlZF9yZXN1bHQKICAgIGlmIGV4cGVjdGVkX3Jlc3VsdCAhPSByZXF1ZXN0cy5jb2Rlcy5vazoKICAgICAgICByZXR1cm4KCiAgICByZXNwb25zZV9qc29uID0ganNvbi5sb2FkcyhyZXMuY29udGVudCkKICAgIHJldHVybiByZXNwb25zZV9qc29uCgojCiMgQ29uc3RydWN0IGFuZCBzZW5kIGFuIFVwZGF0ZUl0ZW0gTm9TUUwgV2ViIEFQSSByZXF1ZXN0CiMKZGVmIG5neF91cGRhdGVfZXhwcmVzc2lvbl9yZXF1ZXN0KAogICAgICAgIHMsYmFzZV91cmwsIHBhdGhfaW5fdXJsLCB0YWJsZV9uYW1lPU5vbmUsIGtleT1Ob25lLCBtb2RlPU5vbmUsIHVwZGF0ZV9leHByPU5vbmUsIHRleHRfZmlsdGVyPU5vbmUsIHR5cGU9IlVwZGF0ZUl0ZW0iLAogICAgICAgIGV4cGVjdGVkX3Jlc3VsdD1yZXF1ZXN0cy5jb2Rlcy5ub19jb250ZW50KToKICAgIHVybCA9IG9zLnBhdGguam9pbihiYXNlX3VybCwgcGF0aF9pbl91cmwpCgogICAgIyBCdWlsZCBhIEpTT04gcmVxdWVzdCBib2R5CiAgICByZXF1ZXN0X2pzb24gPSB7fQoKICAgIGlmIHRhYmxlX25hbWUgaXMgbm90IE5vbmU6CiAgICAgICAgcmVxdWVzdF9qc29uWyJUYWJsZU5hbWUiXSA9IHRhYmxlX25hbWUKCiAgICBpZiBtb2RlIGlzIG5vdCBOb25lOgogICAgICAgIHJlcXVlc3RfanNvblsiVXBkYXRlTW9kZSJdID0gbW9kZQoKICAgIGlmIHVwZGF0ZV9leHByIGlzIG5vdCBOb25lOgogICAgICAgIHJlcXVlc3RfanNvblsiVXBkYXRlRXhwcmVzc2lvbiJdID0gdXBkYXRlX2V4cHIKCiAgICBpZiB0ZXh0X2ZpbHRlciBpcyBub3QgTm9uZToKICAgICAgICByZXF1ZXN0X2pzb25bIkNvbmRpdGlvbkV4cHJlc3Npb24iXSA9IHRleHRfZmlsdGVyCgogICAgcGF5bG9hZCA9IGpzb24uZHVtcHMocmVxdWVzdF9qc29uKQogICAgCiAgICBpZiBXRUJBUElfQ1JFRCBpcyBOb25lOgogICAgICAgaGVhZGVycyA9IHtWM0lPX0hFQURFUl9GVU5DVElPTjogdHlwZSB9CiAgICBlbHNlOgogICAgICAgaGVhZGVycyA9IHtWM0lPX0hFQURFUl9GVU5DVElPTjogdHlwZSAsIkF1dGhvcml6YXRpb24iOiBzdHIoV0VCQVBJX0NSRUQpfQoKICAgICMgU2VuZCB0aGUgcmVxdWVzdAogICAgcmVzID0gcy5wdXQodXJsLCBkYXRhPXBheWxvYWQsIGhlYWRlcnM9aGVhZGVycykKICAgICNhc3NlcnQgcmVzLnN0YXR1c19jb2RlID09IGV4cGVjdGVkX3Jlc3VsdAogICAgcmV0dXJuIHJlcwo="
      env:
        - name: CONTAINER_NAME
          value: bigdata
        - name: DRIVERS_TABLE
          value: /taxi_example/drivers/
        - name: PASSENGERS_TABLE
          value: /taxi_example/passengers/
        - name: CELLS_TABLE
          value: /taxi_example/cells/
      image:
        repository: iguaziodocker/cloud_demo_functions
        tag: "0.0.2"

image:
  repository: "iguaziodocker/cloud_demo"
  tag: "0.0.2"
  pullPolicy: "IfNotPresent"

demo:
  root: /visualization
  container: bigdata
  collection: taxi_example/cells
  refresh: 2000
  center:
    lat: 0
    lng: 0
    zoom: 8
  shift:
    lat: 0
    lng: 0
  heatMap:
    r: 10
    blur: 15
    max: 5.0

service:
  nodePort: 30555
